<h2 class="headline">Neue Nachricht</h2>

<div class="message-container">
  <mat-form-field appearance="outline" class="full-width recipient-field">
    <input
      matInput
      [(ngModel)]="inputValue"
      (input)="onRecipientInput()"
      (keydown.enter)="onEnter()"
      placeholder="An: #channel, oder @jemand oder E-Mail Adresse"
      matTooltip="Empfänger eingeben: @Benutzer, #Channel oder E-Mail"
    />
  </mat-form-field>

  <div class="suggestion-box" *ngIf="showSuggestions">
    <div
      class="suggestion"
      *ngFor="let suggestion of filteredSuggestions"
      (click)="selectSuggestion(suggestion)"
      matTooltip="Empfänger auswählen"
    >
      <img
        class="avatar"
        [src]="suggestion.avatarUrl"
        alt="{{ suggestion.name }}"
      />
      <span>{{ isUserMode ? '@' : '#' }}{{ suggestion.name }}</span>
    </div>
  </div>

  <div class="selected-recipients" *ngIf="selectedRecipients.length">
    <span class="chip" *ngFor="let r of selectedRecipients; let i = index">
      {{ r }}
      <button
        (click)="removeRecipient(i)"
        matTooltip="Empfänger entfernen"
        type="button"
      >
        ×
      </button>
    </span>
  </div>

  <mat-form-field appearance="outline" class="full-width message-input">
    <textarea
      matInput
      [(ngModel)]="message"
      placeholder="Starte eine neue Nachricht"
      rows="4"
      matTooltip="Deine Nachricht hier schreiben"
    ></textarea>
  </mat-form-field>

  <div class="actions">
    <button
      mat-icon-button
      type="button"
      (click)="toggleEmojiPicker()"
      matTooltip="Emoji hinzufügen"
      aria-label="Emoji hinzufügen"
    >
      😊
    </button>

    <button
      mat-icon-button
      type="button"
      (click)="triggerFileInputClick(fileInput)"
      matTooltip="Datei anhängen"
      aria-label="Datei anhängen"
    >
      📎
    </button>
    <input
      #fileInput
      type="file"
      hidden
      (change)="onFileSelected($event)"
    />

    <span *ngIf="fileData" class="file-info" matTooltip="{{ fileData.name }}">
      📄 {{ fileData.name }}
      <button
        type="button"
        (click)="fileData = undefined"
        matTooltip="Datei entfernen"
      >
        ×
      </button>
    </span>

    <span class="flex-spacer"></span>

    <button
      mat-button
      type="button"
      (click)="cancelDialog()"
      matTooltip="Abbrechen und Fenster schließen"
    >
      Abbrechen
    </button>

    <button
      mat-flat-button
      color="primary"
      type="button"
      (click)="send()"
      matTooltip="Nachricht senden"
    >
      Senden
    </button>
  </div>

  <div
    class="emoji-picker"
    *ngIf="emojiPickerVisible"
    (click)="$event.stopPropagation()"
  >
    <span
      *ngFor="let emoji of ['😊', '😂', '🎉', '🚀', '❤️', '🔥']"
      (click)="addEmoji(emoji)"
      class="emoji"
      >{{ emoji }}</span
    >
  </div>
</div>
